{"ast":null,"code":"import _classCallCheck from\"E:/js/react/music-app/React-musicApp/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"E:/js/react/music-app/React-musicApp/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"E:/js/react/music-app/React-musicApp/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"E:/js/react/music-app/React-musicApp/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"E:/js/react/music-app/React-musicApp/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from'react';import PrevIcon from'../../../Icons/PrevIcon';import NextIcon from'../../../Icons/NextIcon';import PauseIcon from'../../../Icons/PauseIcon';import Progress from'../Progress';import ModeIcon1 from'../../../Icons/ModeIcon1';import ModeIcon2 from'../../../Icons/ModeIcon2';import ModeIcon3 from'../../../Icons/ModeIcon3';import ModeIcon4 from'../../../Icons/ModeIcon4';import PlayIcon from'../../../Icons/PlayIcon';import PubSub from'pubsub-js';import{connect}from'react-redux';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Player=/*#__PURE__*/function(_Component){_inherits(Player,_Component);var _super=_createSuper(Player);function Player(props){var _this;_classCallCheck(this,Player);_this=_super.call(this,props);_this.audio=/*#__PURE__*/React.createRef();_this.ratio=0;_this.handlePause=function(hasSourse){if(!hasSourse)return;var pause=_this.state.pause;console.log(pause);if(pause)_this.audio.current.play();else _this.audio.current.pause();_this.setState({pause:!pause});};_this.handleTimeUpdate=function(event){// cur 传给子组件使用\nvar cur=Math.floor(event.target.currentTime);var isHandling=_this.state.isHandling;if(isHandling)return;_this.setState({curTime:cur});// 如果正在调整播放进度，则不改变进度条的长度\nvar width=Math.floor(cur/event.target.duration*350)||0;// 修改 css 变量 感觉会影响性能\ndocument.documentElement.style.setProperty('--progress-bar-width',width+'px');};_this.handleProgressChange=function(newProgress){_this.audio.current.currentTime=newProgress;};_this.calcProgress=function(width){var newProgress=Math.floor((width||0)*_this.ratio);_this.handleProgressChange(newProgress);};_this.handleMouseDown=function(event){// \nif(_this.state.isHandling)return;// 是否是点击事件\nvar isClick=true;var that=_assertThisInitialized(_this);var totalTime=_this.props.time;var top=event.target.closest('.Progress-slider-top');var bar=event.target.closest('.Progress-slider');var barCoord=bar.getBoundingClientRect();// 没有点 top，是点击事件\nif(!top){var width=event.clientX-barCoord.left;_this.calcProgress(width);return;}var topCoord=top.getBoundingClientRect();_this.setState({isHandling:true});// 鼠标指针点击位置与 top 左上角的 offset\nvar start={x:event.clientX,y:event.clientY};var offset={x:event.clientX-topCoord.left,y:event.clientY-topCoord.top};document.addEventListener('mousemove',handleMouseMove);document.addEventListener('mouseup',handleMouseUp);function handleMouseMove(event){if(isClick&&Math.floor(Math.abs(event.clientX-start.x)*that.ratio)!=0)isClick=false;// 拖拽时只改变 css 变量的值\nvar width=event.clientX-barCoord.left;width=width<350?width:350;width=width>0?width:0;that.setState({curTime:Math.floor(width*that.ratio)});document.documentElement.style.setProperty('--progress-bar-width',width+'px');}function handleMouseUp(event){document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);that.setState({isHandling:false});var width=event.clientX-barCoord.left;if(!isClick&&!event.target.closest('.Progress-slider'))bar.classList.remove('Progress-slider-hover');that.calcProgress(width);}};_this.state={curTime:0,pause:false,isHandling:false};return _this;}_createClass(Player,[{key:\"handleChange\",value:// 切歌 \nfunction handleChange(num){this.props.changeSong(num);}// 播放 / 暂停\n},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;PubSub.subscribe('VolumeChange',function(_,volume){_this2.audio.current.volume=volume;});}},{key:\"render\",value:function render(){var _this3=this;// const hasSourse = (this.props.songSrc == '') ? false : true;\nvar _this$props=this.props,mode=_this$props.mode,changeMode=_this$props.changeMode,songSrc=_this$props.songSrc,song=_this$props.song;var _this$state=this.state,curTime=_this$state.curTime,isHandling=_this$state.isHandling,pause=_this$state.pause;var totalTime=Math.floor((song===null||song===void 0?void 0:song.dt)/1000)||0;var id=song?song.id:undefined;this.ratio=totalTime/350;var modeIcon=mode===0?/*#__PURE__*/_jsx(ModeIcon1,{}):mode===1?/*#__PURE__*/_jsx(ModeIcon2,{}):mode===2?/*#__PURE__*/_jsx(ModeIcon3,{}):/*#__PURE__*/_jsx(ModeIcon4,{});return/*#__PURE__*/_jsxs(\"div\",{className:\"Player\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"Player-btns\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"Player-mode\",onClick:changeMode,children:modeIcon}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{className:\"Player-btn\",onClick:function onClick(){return _this3.handleChange(-1);},title:\"\\u4E0A\\u4E00\\u9996\",children:/*#__PURE__*/_jsx(PrevIcon,{})}),/*#__PURE__*/_jsx(\"li\",{className:\"Player-btn play-icon\",title:\"\\u6682\\u505C\",onClick:function onClick(){return _this3.handlePause(true);},children:pause?/*#__PURE__*/_jsx(PlayIcon,{}):/*#__PURE__*/_jsx(PauseIcon,{})}),/*#__PURE__*/_jsx(\"li\",{className:\"Player-btn\",onClick:function onClick(){return _this3.handleChange(1);},title:\"\\u4E0B\\u4E00\\u9996\",children:/*#__PURE__*/_jsx(NextIcon,{})})]})]}),/*#__PURE__*/_jsx(Progress,{totalTime:totalTime,curTime:curTime,className:\"Player-progress\",handleProgressChange:this.handleProgressChange,handleMouseDown:this.handleMouseDown,isHandling:isHandling}),/*#__PURE__*/_jsx(\"audio\",{ref:this.audio,src:id?\"https://music.163.com/song/media/outer/url?id=\".concat(id,\".mp3\"):'',onTimeUpdate:this.handleTimeUpdate,autoPlay:true,children:\"Your browser can't support HTML5 Audio\"})]});}}]);return Player;}(Component);export default connect(function(state){return{song:state.song};},{})(Player);","map":{"version":3,"sources":["E:/js/react/music-app/React-musicApp/src/Component/Bottom/Player/index.jsx"],"names":["React","Component","PrevIcon","NextIcon","PauseIcon","Progress","ModeIcon1","ModeIcon2","ModeIcon3","ModeIcon4","PlayIcon","PubSub","connect","Player","props","audio","createRef","ratio","handlePause","hasSourse","pause","state","console","log","current","play","setState","handleTimeUpdate","event","cur","Math","floor","target","currentTime","isHandling","curTime","width","duration","document","documentElement","style","setProperty","handleProgressChange","newProgress","calcProgress","handleMouseDown","isClick","that","totalTime","time","top","closest","bar","barCoord","getBoundingClientRect","clientX","left","topCoord","start","x","y","clientY","offset","addEventListener","handleMouseMove","handleMouseUp","abs","removeEventListener","classList","remove","num","changeSong","subscribe","_","volume","mode","changeMode","songSrc","song","dt","id","undefined","modeIcon","handleChange"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport PrevIcon from '../../../Icons/PrevIcon';\r\nimport NextIcon from '../../../Icons/NextIcon';\r\nimport PauseIcon from '../../../Icons/PauseIcon';\r\nimport Progress from '../Progress';\r\nimport ModeIcon1 from '../../../Icons/ModeIcon1';\r\nimport ModeIcon2 from '../../../Icons/ModeIcon2';\r\nimport ModeIcon3 from '../../../Icons/ModeIcon3';\r\nimport ModeIcon4 from '../../../Icons/ModeIcon4';\r\nimport PlayIcon from '../../../Icons/PlayIcon';\r\nimport PubSub from 'pubsub-js';\r\nimport { connect } from 'react-redux';\r\n\r\nclass Player extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      curTime: 0,\r\n      pause: false,\r\n      isHandling: false,\r\n    };\r\n\r\n  }\r\n  audio = React.createRef();\r\n  ratio = 0;\r\n  // 切歌 \r\n  handleChange(num) {\r\n    this.props.changeSong(num);\r\n  }\r\n  // 播放 / 暂停\r\n  handlePause = (hasSourse) => {\r\n    if (!hasSourse) return;\r\n    const { pause } = this.state;\r\n    console.log(pause);\r\n    if (pause) this.audio.current.play();\r\n    else this.audio.current.pause();\r\n    this.setState({\r\n      pause: !pause,\r\n    })\r\n  }\r\n  // 监听播放器进度变化\r\n  handleTimeUpdate = (event) => {\r\n    // cur 传给子组件使用\r\n    const cur = Math.floor(event.target.currentTime);\r\n    const { isHandling } = this.state;\r\n    if (isHandling) return;\r\n    this.setState({\r\n      curTime: cur,\r\n    })\r\n    // 如果正在调整播放进度，则不改变进度条的长度\r\n    const width = Math.floor(cur / event.target.duration * 350) || 0;\r\n    // 修改 css 变量 感觉会影响性能\r\n    document.documentElement.style.setProperty('--progress-bar-width', width + 'px');\r\n  }\r\n  // 用户改变 audio 播放进度\r\n  handleProgressChange = (newProgress) => {\r\n    this.audio.current.currentTime = newProgress;\r\n  }\r\n\r\n  calcProgress = (width) => {\r\n    const newProgress = Math.floor((width || 0) * this.ratio);\r\n    this.handleProgressChange(newProgress);\r\n  }\r\n\r\n  handleMouseDown = (event) => {\r\n    // \r\n    if (this.state.isHandling) return;\r\n\r\n    // 是否是点击事件\r\n    let isClick = true;\r\n\r\n    const that = this;\r\n    const { time: totalTime } = this.props;\r\n    const top = event.target.closest('.Progress-slider-top');\r\n    const bar = event.target.closest('.Progress-slider');\r\n    const barCoord = bar.getBoundingClientRect();\r\n    // 没有点 top，是点击事件\r\n    if (!top) {\r\n      const width = event.clientX - barCoord.left;\r\n      this.calcProgress(width);\r\n      return;\r\n    }\r\n\r\n    const topCoord = top.getBoundingClientRect();\r\n    this.setState({\r\n      isHandling: true,\r\n    })\r\n\r\n    // 鼠标指针点击位置与 top 左上角的 offset\r\n    const start = {\r\n      x: event.clientX,\r\n      y: event.clientY\r\n    }\r\n    const offset = {\r\n      x: event.clientX - topCoord.left,\r\n      y: event.clientY - topCoord.top,\r\n    }\r\n\r\n    document.addEventListener('mousemove', handleMouseMove);\r\n    document.addEventListener('mouseup', handleMouseUp);\r\n\r\n    function handleMouseMove(event) {\r\n      if (isClick && Math.floor(Math.abs(event.clientX - start.x) * that.ratio) != 0) isClick = false;\r\n\r\n      // 拖拽时只改变 css 变量的值\r\n      let width = event.clientX - barCoord.left;\r\n      width = width < 350 ? width : 350;\r\n      width = width > 0 ? width : 0;\r\n\r\n      that.setState({\r\n        curTime: Math.floor(width * that.ratio),\r\n      })\r\n      document.documentElement.style.setProperty('--progress-bar-width', width + 'px');\r\n    }\r\n\r\n    function handleMouseUp(event) {\r\n      document.removeEventListener('mousemove', handleMouseMove);\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n\r\n      that.setState({\r\n        isHandling: false,\r\n      })\r\n      const width = event.clientX - barCoord.left;\r\n\r\n      if (!isClick && !event.target.closest('.Progress-slider'))  bar.classList.remove('Progress-slider-hover');\r\n      that.calcProgress(width);\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    PubSub.subscribe('VolumeChange', ((_, volume) => {\r\n      this.audio.current.volume = volume;\r\n    }))\r\n  }\r\n  render() {\r\n    // const hasSourse = (this.props.songSrc == '') ? false : true;\r\n    const { mode, changeMode, songSrc,song } = this.props;\r\n    const { curTime, isHandling, pause } = this.state;\r\n\r\n    const totalTime = Math.floor(song?.dt/1000) || 0 ;\r\n    const id = (song)? song.id : undefined;\r\n\r\n    this.ratio = totalTime / 350;\r\n    const modeIcon = (mode === 0) ?\r\n      <ModeIcon1 /> : (mode === 1) ?\r\n        <ModeIcon2 /> : (mode === 2) ?\r\n          <ModeIcon3 /> : <ModeIcon4 />\r\n    return (\r\n      <div className=\"Player\">\r\n        <div className=\"Player-btns\">\r\n          <div className=\"Player-mode\" onClick={changeMode}>\r\n            {modeIcon}\r\n          </div>\r\n          <ul>\r\n            <li className=\"Player-btn\" onClick={() => this.handleChange(-1)} title=\"上一首\">\r\n              <PrevIcon />\r\n            </li>\r\n            <li className=\"Player-btn play-icon\" title=\"暂停\" onClick={() => this.handlePause(true)}>\r\n              {pause ? <PlayIcon /> : <PauseIcon />}\r\n            </li>\r\n            <li className=\"Player-btn\" onClick={() => this.handleChange(1)} title=\"下一首\">\r\n              <NextIcon />\r\n            </li>\r\n          </ul>\r\n        </div>\r\n        <Progress\r\n          totalTime={totalTime}\r\n          curTime={curTime}\r\n          className=\"Player-progress\"\r\n          handleProgressChange={this.handleProgressChange}\r\n          handleMouseDown={this.handleMouseDown}\r\n          isHandling={isHandling}\r\n        />\r\n        <audio\r\n          ref={this.audio}\r\n          src={(id)?`https://music.163.com/song/media/outer/url?id=${id}.mp3`:''}\r\n          onTimeUpdate={this.handleTimeUpdate}\r\n          autoPlay={true}\r\n        >Your browser can't support HTML5 Audio</audio>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport default connect(\r\n  state => ({song:state.song}),\r\n  {}\r\n)(Player)"]},"metadata":{},"sourceType":"module"}